# Вопросы с собеседований на вакансию Pentester (Специалист по тестированию на проникновение)

## Оглавление
1. [Вопросы](#вопросы)
2. [Ответы](#ответы)
	
	1. [OWASP TOP 10.](#1-owasp-top-10)
		
		* [A01:2021-Broken Access Control](#a012021-broken-access-control)
		* [A02:2021-Cryptographic Failures](#a022021-cryptographic-failures)
		* [A03:2021-Injection](#a032021-injection)
		* [A04:2021-Insecure Design](#a042021-insecure-design)
		* [A05:2021-Security Misconfiguration](#a052021-security-misconfiguration)
		* [A06:2021-Vulnerable and Outdated Components](#a062021-vulnerable-and-outdated-components)
		* [A07:2021-Identification and Authentication Failures](#a072021-identification-and-authentication-failures)
		* [A08:2021-Software and Data Integrity Failures](#a082021-software-and-data-integrity-failures)
		* [A09:2021-Security Logging and Monitoring Failures](#a092021-security-logging-and-monitoring-failures)
		* [A10:2021-Server-Side Request Forgery](#a102021-server-side-request-forgery)
		
	2. [Как работает веб-сервис.](#2-как-работает-веб-сервис)
	3. [SQL-Injection.](#3-sql-injection)
	4. [Cross Site Scripting (XSS)](#4-cross-site-scripting-xss)
	5. [Path Treversal и File Inclusion.](#5-path-treversal-и-file-inclusion)
	6. [Опишите методику проведения пентеста.](#6-опишите-методику-проведения-пентеста)
	7. [Модель OSI и описание служб работающих на каждом уровне.](#7-модель-osi-и-описание-служб-работающих-на-каждом-уровне)
	8. [Известные вам методологии тестирования.](#8-известные-вам-методологии-тестирования)
	9. [Active Directory.](#9-active-directory)
	10. [Знание Windows и Linux.](#10-знание-windows-и-linux)
	11. [Пример системы для пентеста и описание полного алгоритма (логики проведения пентеста).](#11-пример-системы-для-пентеста-и-описание-полного-алгоритма-логики-проведения-пентеста)
	12. [Отчёт.](#12-отчёт)

3. [Практические задания](#практические-задания)
4. [Решения практических заданий](#решения-практических-заданий)

## Вопросы

1. OWASP TOP 10. 
	Знаете ли вы что такое OWASP TOP 10? Если да, расскажите про какой-либо из пунктов. В чем значимость этих уязвимостей. Типы подуязвимостей. Примеры.
2. Как работает веб-сервис.
	Опишите процессы, происходящие от ввода в URL строку google.com, до получение страницы поисковика (как работает веб-сервис?) Какие атаки на каждом из этапов могут быть реализованы?
3. SQL-Injection.
	Какие виды SQL-инъекций вы знаете? Расскажите о них.
4. Cross Site Scripting (XSS)
	* Какие виды XSS вы знаете? Расскажите о них.
	* Что отличает DOM XSS от хранимой XSS (помимо факта работы непосредственно с DOM)?
5. Path Treversal и File Inclusion
	Расскажите в чём разница между уязвимостями path treversal и file inclusion. Что опаснее и почему?
6. Опишите методику проведения пентеста.
	Указать этапы, набор утилит, которые вы будете использовать на каждом из этапов, а также пояснение, как вы будете использовать найденную на каждом из этапов информацию в дальнейшем.
7. Модель OSI и описание служб работающих на каждом уровне.
8. Известные вам методологии тестирования. Опишите их область применения и ключевые отличия.
9. Active Directory.
	* Что такое Active Directory? 
	* Для чего она нужна?
	* Зачем ее используют? (Для использования ролевых моделей) 
	* Что такое дерево и лес, как они формируются? 
	* Какие атаки на AD вам известны?
10. Знание Windows и Linux. 
	Вопросы по bash, демоны, логирование, администрирование, встроенные брендмауеры.
11. Пример системы для пентеста и описание полного алгоритма (логики проведения пентеста).
12. Отчёт.
	Что должно входить в отчет по результатам тестирования?

## Ответы

### 1. OWASP TOP 10.

(Знаете ли вы что такое OWASP TOP 10? Если да, расскажите про какой-либо из пунктов. В чем значимость этих уязвимостей. Типы подуязвимостей. Примеры.)

OWASP - Open Web Application Security Project (Открытый проект безопасности web-приложений) - это открытое сообщество, позволяющее организациям разрабатывать, приобретать и поддерживать безопасные приложения и интерфейсы прикладного программирования (API). Предоставляет стандарты, презентации, книги, видео, передовые исследования.

TOP 10 - Список из 10 самых популярных (часто встречающихся и опасных) уязвимостей в веб-приложениях. На 2021 год в них входят:

* А.01 - Недостатки контроля доступа (Broken Access Control). 34 Common Weakness Enumerations (CWEs), сопоставленные с Broken Access Control, чаще встречаются в приложениях, чем любая другая категория.
* А.02 - Сбои криптографии (Cryptographic Failures), ранее "раскрытие конфиденциальных данных". Особое внимание здесь уделяется сбоям, связанным с криптографией, которые часто приводят к раскрытию конфиденциальных данных или компрометации системы.
* А.03 - Внедрения (Injection). 33 CWE, сопоставленные с этой категорией, являются вторыми по частоте появления в приложениях.
* А.04 - Не безопасный дизайн (Inesecure Design). Категория, в которой основное внимание уделяется рискам, связанным с недостатками дизайна (Шаблоны, архитектура).
* А.05 - Некорректная настройка параметров безопасности (Security Misconfiguration). Рост встречаемости данной уязвимости связан с увеличением количества переходов на ПО с широкими возможностями настройки.
* А.06 - Уязвимые и устаревшие компоненты (Vulnerable and Outdated Components). Это единственная категория, в которой никакие распространенные уязвимости и воздействия (CVE) не сопоставлены с включенными CWE, поэтому в их оценках учитываются эксплойт и веса воздействия по умолчанию, равные 5,0.
* А.07 - Ошибки (Сбои) идентификации и аутентификации (Identification and Authentication Failures). Похоже, этому способствует повышенная доступность стандартизированных фреймворков. 
* А.08 - Сбои целостности программного обеспечения и данных (Software and Data Integrity Failures). Основное внимание уделяется предположениям, связанным с обновлениями программного обеспечения, критическими данными и конвейерами CI/CD без проверки целостности. 10 CWE в этой категории. Небезопасная десериализация из 2017 года теперь является частью этой более широкой категории.
* А.09 - Сбои ведения журнала и мониторинга безопасности (Security Logging and Monitoring Failures). Эта категория расширена за счет включения большего количества типов сбоев, сложна для тестирования и недостаточно хорошо представлена в данных CVE/CVSS. Однако сбои в этой категории могут напрямую повлиять на видимость, оповещение об инцидентах и судебную экспертизу.
* А.10 - Подделка запросов на стороне сервера (Server-Side Request Forgery - SSRF).

------------------------------------------------------------

#### A01:2021-Broken Access Control 

[Source](https://owasp.org/Top10/A01_2021-Broken_Access_Control/)

Контроль доступом определяет политику разграничения доступа таким образом, чтобы пользователи не могули действовать за пределами своих предполагаемых полномочий. Сбои обычно приводят к НСД или к выполнению бизнес-функции за пределами полномочий пользователя. Общие уязвимости контроля доступа включают в себя:

* Нарушение принципа наименьших привилегий или запрета по умолчанию, (доступ предоставляется всем, когда должен предоставляться только для определенных задач, ролей или пользователей).
* Обход проверок управления доступом путем изменения URL-адреса (изменение параметров или принудительный просмотр), внутреннего состояния приложения или HTML-страницы либо с помощью инструмента атаки, изменяющего запросы API.
* Разрешение просмотра или редактирования чужой учётной записи путем предоставления ее уникального идентификатора (небезопасные прямые ссылки на объекты).
* Доступ к API без элементов управления доступом для POST, PUT и DELETE.
* Повышение привилегий. Работа в качестве пользователя без входа в систему или в качестве администратора при входе в систему в качестве пользователя.
* Манипуляции с метаданными, такие как воспроизведение или подделка маркера управления доступом JSON Web Token (JWT), а также использование файла cookie или скрытого поля для повышения привилегий или злоупотребления аннулированием JWT.
* Неправильная конфигурация CORS (Cross-origin resource sharing) разрешает доступ к API из неавторизованных/ненадежных источников.
* Принудительный просмотр аутентифицированных страниц в качестве неаутентифицированного пользователя или привилегированных страниц в качестве обычного пользователя.

Как предотвратить:

* Запрещать по умолчанию все ресурсы, за исключением общедоступных.
* Реализовать механизмы управления доступом один раз и повторно использовать их во всем приложении, включая минимизацию использования общего доступа к ресурсам между источниками (CORS).
* Элементы управления доступом должны обеспечивать закрепление прав собственности на записи, а не допускать, чтобы пользователь может создавать, читать, обновлять или удалять любую запись.
* Ограничивающие бизнес-требования к уникальным приложениям должны обеспечиваться моделями предметной области.
* Отключите список каталогов веб-сервера и убедитесь, что метаданные файлов (например, .git) и файлы резервных копий отсутствуют в корнях веб-сайтов.
* Регистрируйте сбои управления доступом, предупреждайте администраторов, когда это необходимо (например, повторяющиеся сбои).
* Ограничьте скорость доступа к API и контроллеру, чтобы свести к минимуму вред от автоматизированных инструментов атаки.
* Идентификаторы сеансов с отслеживанием состояния должны быть аннулированы на сервере после выхода из системы. Жетоны JWT без сохранения состояния должны быть недолговечными, чтобы свести к минимуму окно возможностей для злоумышленника. Для более долгоживущих JWT настоятельно рекомендуется следовать стандартам OAuth для отзыва доступа.

Для данного блока уязвимостей в OWASP определили 34 CWE (подробнее можно посмотреть в источнике), здесь же приведены наиболее простые/популярные:

* Path Traversal
* Permission Issuse
* Cross-Site Request Forgery (CSRF)
* Insecure Temporary File
* Open Redirect
* Missing/Incorrect Authorization

------------------------------------------------------------

#### A02:2021-Cryptographic Failures

[Source](https://owasp.org/Top10/A02_2021-Cryptographic_Failures/)

Прежде всего, необходимо определить потребности в защите данных при передаче и хранении. Например, пароли, номера кредитных карт, медицинские записи, личная информация и коммерческая тайна требуют дополнительной защиты, в основном, если эти данные подпадают под действие законов о конфиденциальности, например, Общего регламента ЕС по защите данных (GDPR), или нормативных актов, к примеру о защите финансовых данных, таких как, стандарт безопасности данных PCI (PCI DSS). 

Чем может провоцироваться уязвимость:

* Передача данных в открытом виде. Это касается таких протоколов, как HTTP, SMTP, FTP, а также использующих обновления TLS, такие как STARTTLS. Как во внутреннем взаимодействии, так и при работе с Интернетом.
* Использование старых или слабых криптографических алгоритмов или протоколы по умолчанию или в старом коде.
* Использование криптографических ключей по умолчанию, создание или повторное использование слабых криптографических ключей, или отсутствие надлежащего управление ключами или их ротации. 
* Наличие криптоключей в репозиториях исходного кода.
* Не использование шифрования там где это необходимо, например, отсутствуют какие-либо директивы безопасности HTTP-заголовков (браузера) или заголовки.
* Некорректно проверяется полученный сертификат сервера и цепочка доверия.
* Векторы инициализации игнорируются, используются повторно или создаются недостаточно безопасно для криптографического режима работы. Используется небезопасный режим работы, такой как ECB. Используется простое шифрование, когда шифрование с проверкой подлинности является более подходящим.
* Используются пароли в качестве криптографических ключей при отсутствии функции получения ключа на основе пароля.
* Используется случайность в криптографических целях, не предназначенных для удовлетворения криптографических требований. В правильной криптографической функции перезаписана разработчиком встроенная в нее надежную функция  заполнения исходным кодом, которому не хватает энтропии/непредсказуемости.
* Используются устаревшие хеш-функции, такие как MD5 или SHA1, или используются некриптографические хеш-функции, когда нужны криптографические хеш-функции.
* Используются устаревшие методы криптографического заполнения, такие как PKCS номер 1 v1.5.
* Неуместное использование сообщений об ошибках с криптографией или информационных сообщений по сторонним каналам, например, в форме атак оракула заполнения.

Как предотвратить:

* Классифицировать данные, обрабатываемые, сохраняемые или передаваемые приложением. Определите, какие данные являются конфиденциальными в соответствии с законами о конфиденциальности, нормативными требованиями или потребностями бизнеса.
* Не храните конфиденциальные данные без необходимости. Откажитесь от этого как можно скорее или используйте токенизацию или даже усечение в соответствии с PCI DSS. Данные, которые не сохраняются, не могут быть украдены.
* Обязательно зашифруйте все хранимые конфиденциальные данные.
* Обеспечьте наличие актуальных и надежных стандартных алгоритмов, протоколов и ключей; используйте правильное управление ключами.
* Шифруйте все передаваемые данные с помощью безопасных протоколов, таких как TLS с шифрованием прямой секретности (FS), приоритезацией шифров сервером и безопасными параметрами. Обеспечьте шифрование с помощью таких директив, как HTTP Strict Transport Security (HSTS).
* Отключите кэширование ответов, содержащих конфиденциальные данные.
* Примените необходимые меры безопасности в соответствии с классификацией данных.
* Не используйте устаревшие протоколы, такие как FTP и SMTP, для передачи конфиденциальных данных.
* Храните пароли, используя надежные адаптивные и соленые функции хеширования с коэффициентом работы (коэффициентом задержки), например Argon2, scrypt, bcrypt или PBKDF2.
* Всегда используйте шифрование с проверкой подлинности (аутентифицированное), а не просто шифрование.
* Ключи должны генерироваться криптографически случайным образом и храниться в памяти в виде массивов байтов. Если используется пароль, то он должен быть преобразован в ключ с помощью соответствующей функции получения базового ключа пароля.
* Избегайте устаревших криптографических функций и схем заполнения, таких как MD5, SHA1, PKCS номер 1 v1.5.
* Самостоятельно проверяйте эффективность конфигурации и настроек.

Для данного блока уязвимостей в OWASP определили 29 CWE (подробнее можно посмотреть в источнике), здесь же приведены наиболее простые/популярные:

* Weak Encoding for Password
* Cryptographic Issuse
* Use of Hard-coded Cyptographic Key
* Use of a Broken or Risky Cryptographic Algorithm
* Unprotected Transport of Credentials
* Use of a One-Way Hash without a Salt (or Predictable Salt)

------------------------------------------------------------

#### A03:2021-Injection

[Source](https://owasp.org/Top10/A03_2021-Injection/)

Приложение уязвимо для атаки, когда:

* Введенные пользователем данные не проверяются, не фильтруются и не очищаются приложением.
* Динамические запросы или непараметризованные вызовы без контекстно-зависимого экранирования используются непосредственно в интерпретаторе.
* Враждебные данные используются в параметрах поиска объектно-реляционного сопоставления (ORM) для извлечения дополнительных конфиденциальных записей.
* Враждебные данные используются напрямую или объединяются. SQL или команда содержат структуру и вредоносные данные в динамических запросах, командах или хранимых процедурах.

Некоторые из наиболее распространенных инъекций (внедрений) — SQL, NoSQL, команда ОС, реляционное сопоставление объектов (ORM), LDAP и внедрение языка выражений (EL) или библиотеки навигации по графу объектов (OGNL). 

Концепция одинакова среди всех интерпретаторов. Проверка исходного кода — лучший способ определить, уязвимы ли приложения для инъекций. 

Настоятельно рекомендуется автоматическое тестирование всех параметров, заголовков, URL-адресов, файлов cookie, входных данных JSON, SOAP и XML. Организации могут включать статические (SAST), динамические (DAST) и интерактивные (IAST) инструменты тестирования безопасности приложений в конвейер CI/CD, чтобы выявлять внедренные недостатки перед развертыванием в рабочей среде.

Как предотвратить:

* Предпочтительным вариантом является использование безопасного API, который полностью исключает использование интерпретатора, предоставляет параметризованный интерфейс или переходит на средства объектно-реляционного сопоставления (ORM).
	_Примечание_. Даже если хранимые процедуры параметризованы, они все равно могут привести к SQL-инъекциям, если PL/SQL или T-SQL объединяют запросы и данные или выполняют враждебные данные с помощью EXECUTE IMMEDIATE или exec().
* Используйте положительную проверку ввода на стороне сервера. Это не полная защита, так как многие приложения требуют специальных символов, таких как текстовые области или API для мобильных приложений.
* Для любых остаточных динамических запросов экранируйте специальные символы, используя специальный синтаксис escape для этого интерпретатора.
	_Примечание_. Структуры SQL, такие как имена таблиц, имена столбцов и т. д., не могут быть экранированы, поэтому имена структур, предоставляемые пользователем, опасны. Это распространенная проблема в программном обеспечении для написания отчетов.
* Используйте LIMIT и другие элементы управления SQL в запросах, чтобы предотвратить массовое раскрытие записей в случае внедрения SQL.

Для данного блока уязвимостей в OWASP определили 33 CWE (подробнее можно посмотреть в источнике), здесь же приведены наиболее простые/популярные:

* SQL and NoSQL Injection
* Cross Site Scripting (XSS)
* Command Injection and OS Command Injection
* CRLF Injection
* XPath Injection
* Unsafe Reflection

------------------------------------------------------------

#### A04:2021-Insecure Design

[Source](https://owasp.org/Top10/A04_2021-Insecure_Design/)

Небезопасный дизайн — это широкая категория, представляющая различные недостатки, выраженные как «отсутствующий или неэффективный дизайн элемента управления». Небезопасный дизайн не является источником всех остальных 10 категорий риска. Есть разница между небезопасным дизайном и небезопасной реализацией. Мы различаем недостатки дизайна и дефекты реализации по той причине, что у них разные первопричины и методы исправления. Безопасный дизайн все еще может иметь дефекты реализации, приводящие к уязвимостям, которые могут быть использованы. Небезопасный дизайн не может быть исправлен идеальной реализацией, поскольку по определению необходимые средства безопасности никогда не создавались для защиты от конкретных атак. Одним из факторов, способствующих небезопасному проектированию, является отсутствие профилирования бизнес-рисков, присущего разрабатываемому программному обеспечению или системе, и, следовательно, невозможность определить, какой уровень безопасности требуется.

Безопасный дизайн — это культура и методология, которые постоянно оценивают угрозы и обеспечивают надежную разработку и тестирование кода для предотвращения известных методов атак. Моделирование угроз должно быть интегрировано в сеансы уточнения (или аналогичные действия); ищите изменения в потоках данных и управлении доступом или других мерах безопасности.

Для безопасного программного обеспечения требуется безопасный жизненный цикл разработки, некоторая форма безопасного шаблона проектирования, методология проложенной дороги, защищенная библиотека компонентов, инструменты и моделирование угроз. Обратитесь к своим специалистам по безопасности в начале проекта программного обеспечения на протяжении всего проекта и обслуживания вашего программного обеспечения. Рассмотрите возможность использования модели OWASP Software Assurance Maturity Model (SAMM), чтобы структурировать свои усилия по разработке безопасного программного обеспечения.

Как предотвратить:

* Создайте и используйте безопасный жизненный цикл разработки вместе со специалистами AppSec, чтобы помочь оценить и разработать элементы управления, связанные с безопасностью и конфиденциальностью.
* Создавайте и используйте библиотеку безопасных шаблонов проектирования или готовых к использованию компонентов асфальтированной дороги.
* Используйте моделирование угроз для критической аутентификации, управления доступом, бизнес-логики и ключевых потоков.
* Интегрируйте язык безопасности и элементы управления в пользовательские истории.
* Интегрируйте проверки правдоподобия на каждом уровне вашего приложения (от интерфейса до сервера).
* Напишите модульные и интеграционные тесты, чтобы убедиться, что все критические потоки устойчивы к модели угроз. Скомпилируйте варианты использования и варианты неправильного использования для каждого уровня вашего приложения.
* Разделяйте многоуровневые уровни на системные и сетевые уровни в зависимости от требований к воздействию и защите.
* Надежно разделяйте арендаторов по дизайну на всех уровнях.
* Ограничить потребление ресурсов пользователем или службой.

Для данного блока уязвимостей в OWASP определили 40 CWE (подробнее можно посмотреть в источнике), здесь же приведены наиболее простые/популярные:

* Generation of Error Message Containing Sensitive Information
* Unprotected Storage of Credentials
* Use of Web Browser Cache/ Persistent Cookies Containing Sensitive Information
* External Control of Critical State Data
* Trusting HTTP Permition Methods on the Server Side
* Business Logic Error

------------------------------------------------------------

#### A05:2021-Security Misconfiguration

[Source](https://owasp.org/Top10/A05_2021-Security_Misconfiguration/)

Приложение может быть уязвимым, если в нём:

* Отсутствует надлежащее усиление безопасности в любой части стека приложений или неправильно настроены разрешения для облачных сервисов.
* Включены или установлены ненужные функции (например, ненужные порты, службы, страницы, учетные записи или привилегии).
* Учетные записи по умолчанию и их пароли по-прежнему включены и не изменяются.
* Обработка ошибок показывает трассировку стека или другие слишком информативные сообщения об ошибках для пользователей.
* В обновленных системах последние функции безопасности отключены или настроены небезопасно.
* Параметры безопасности на серверах приложений, платформах приложений (например, Struts, Spring, ASP.NET), библиотеках, базах данных и т.д. не устанавливаются в безопасные значения.
* Сервер не отправляет заголовки или директивы безопасности, или для них не установлены безопасные значения.
* Программное обеспечение устарело или уязвимо (см. A06:2021 — Уязвимые и устаревшие компоненты).

Как предотвратить:

* Повторяемый процесс усиления безопасности позволяет быстро и легко развернуть другую среду, которая должным образом заблокирована. Среды разработки, контроля качества и производства должны быть настроены одинаково, с использованием разных учетных данных в каждой среде. Этот процесс следует автоматизировать, чтобы свести к минимуму усилия, необходимые для настройки новой безопасной среды.
* Минимальная платформа без лишних функций, компонентов, документации и примеров. Удалите или не устанавливайте неиспользуемые функции и платформы.
* Задача по просмотру и обновлению конфигураций, соответствующих всем примечаниям, обновлениям и исправлениям безопасности, в рамках процесса управления исправлениями (см. A06:2021 — Уязвимые и устаревшие компоненты). Проверьте разрешения облачного хранилища (например, разрешения корзины S3).
* Сегментированная архитектура приложений обеспечивает эффективное и безопасное разделение между компонентами или арендаторами с помощью сегментации, контейнеризации или облачных групп безопасности (ACL).
* Отправка директив безопасности клиентам, например, заголовков безопасности.
* Автоматизированный процесс проверки эффективности конфигураций и настроек во всех средах.

Для данного блока уязвимостей в OWASP определили 20 CWE (подробнее можно посмотреть в источнике), здесь же приведены наиболее простые/популярные:

* Password in Configuration File
* .NET Misconfigurations
* Use a hard-coded, Security-relevant Constants
* Missing Custom Error Page
* Sensitive Cookie Without "HttpOnly" Flag
* CWE-16 Configuration

------------------------------------------------------------

#### A06:2021-Vulnerable and Outdated Components

[Source](https://owasp.org/Top10/A06_2021-Vulnerable_and_Outdated_Components/)

Возникают когда:

* Вы не знаете версии всех используемых вами компонентов (как на стороне клиента, так и на стороне сервера). Сюда входят компоненты, которые вы используете напрямую, а также вложенные зависимости.
* ПО уязвимо, не поддерживается или устарело. Сюда входят ОС, веб-сервер/сервер приложений, система управления базами данных (СУБД), приложения, API и все компоненты, среды выполнения и библиотеки.
* Вы не выполняете регулярное сканирование на наличие уязвимостей и не подписываетесь на бюллетени по безопасности, связанные с используемыми вами компонентами.
* Вы не исправляете или не обновляете базовую платформу, фреймворки и зависимости своевременно и с учетом рисков. Это обычно происходит в средах, когда исправление является ежемесячной или ежеквартальной задачей под контролем изменений, что оставляет организации открытыми для дней или месяцев ненужного воздействия на уязвимости, которые могут быть исправлены.
* Разработчики ПО не проверяют совместимость обновленных, модернизированных или исправленных библиотек.
* Вы не защищаете конфигурации компонентов (см. A05:2021-Security Misconfiguration).

Как предотвратить:

* Удалите неиспользуемые зависимости, ненужные функции, компоненты, файлы и документацию.
* Постоянно проводите инвентаризацию версий как клиентских, так и серверных компонентов (например, фреймворков, библиотек) и их зависимостей, используя такие инструменты, как версии, OWASP Dependency Check, retire.js и т.д. Непрерывно отслеживайте такие источники, как Common Vulnerability and Exposures (CVE) и Национальная база данных уязвимостей (NVD) для уязвимостей в компонентах. Используйте инструменты анализа состава программного обеспечения для автоматизации процесса. Подпишитесь на оповещения по электронной почте об уязвимостях безопасности, связанных с используемыми вами компонентами.
* Получайте компоненты только из официальных источников по безопасным ссылкам. Отдавайте предпочтение подписанным пакетам, чтобы снизить вероятность включения модифицированного вредоносного компонента (см. A08:2021 — Сбои целостности программного обеспечения и данных).
* Отслеживайте библиотеки и компоненты, которые не поддерживаются или не создают исправления безопасности для более старых версий. Если исправление невозможно, рассмотрите возможность развертывания виртуального исправления для мониторинга, обнаружения или защиты от обнаруженной проблемы.

Для данного блока уязвимостей в OWASP определили 3 CWE:

* CWE-937 OWASP Top 10 2013: Using Components with Known Vulnerabilities
* CWE-1035 2017 Top 10 A9: Using Components with Known Vulnerabilities
* CWE-1104 Use of Unmaintained Third Party Components

------------------------------------------------------------

#### A07:2021-Identification and Authentication Failures

[Source](https://owasp.org/Top10/A07_2021-Identification_and_Authentication_Failures/)

Подтверждение личности пользователя, проверка подлинности и управление сеансом имеют решающее значение для защиты от атак, связанных с проверкой подлинности. Возможны недостатки аутентификации, если приложение:

* Разрешает автоматические атаки, такие как вброс учетных данных, когда у злоумышленника есть список действительных имен пользователей и паролей.
* Разрешает грубую силу (перебор) или другие автоматизированные атаки.
* Разрешает использование стандартных, слабых или хорошо известных паролей, таких как «Password1» или «admin/admin».
* Использует слабые или неэффективные процессы восстановления учетных данных и забытого пароля, такие как «ответы, основанные на знаниях», которые нельзя сделать безопасными.
* Использует простые текстовые, зашифрованные или слабо хешированные хранилища данных паролей (см. A02:2021-Криптографические сбои).
* Не использует или использует неэффективную многофакторнаю аутентификацию (MFA).
* Предоставляет идентификатор сеанса в URL-адресе.
* Повторно использует идентификатор сеанса после успешного входа в систему.
* Неправильно аннулирует идентификаторы сеанса. Сеансы пользователей или маркеры проверки подлинности (в основном маркеры единого входа (SSO)) не аннулируются должным образом во время выхода из системы или периода бездействия.

Как предотвратить:

* По возможности внедрите многофакторную аутентификацию.
* Не отправляйте и не развертывайте с какими-либо учетными данными по умолчанию.
* Внедряйте проверку слабых паролей.
* Приведите политики длины, сложности и ротации паролей в соответствие с рекомендациями Национального института стандартов и технологий (NIST) 800-63b в разделе 5.1.1 для запомненных секретов или другими современными политиками паролей, основанными на фактических данных.
* Убедитесь, что регистрация, восстановление учетных данных и пути API защищены от атак с перечислением учетных записей, используя одни и те же сообщения для всех результатов.
* Ограничьте или задержите неудачные попытки входа в систему, но будьте осторожны, чтобы не создать сценарий отказа в обслуживании. Регистрируйте все сбои и оповещайте администраторов при обнаружении подмены учетных данных, грубой силы или других атак.
* Используйте безопасный встроенный диспетчер сеансов на стороне сервера, который генерирует новый случайный идентификатор сеанса с высокой энтропией после входа в систему. Идентификатор сеанса не должен быть в URL-адресе, должен быть надежно сохранен и аннулирован после выхода из системы, бездействия и абсолютного тайм-аута.

Для данного блока уязвимостей в OWASP определили 22 CWE (подробнее можно посмотреть в источнике), здесь же приведены наиболее простые/популярные:

* Use of Hard-coded Password
* Missing Critical Step in Authentication
* Unverified Password Change
* Session Fixation
* Authentication Bypasses
* Improper Validation of Certificate with Host Mismatch

------------------------------------------------------------

#### A08:2021-Software and Data Integrity Failures

[Source](https://owasp.org/Top10/A08_2021-Software_and_Data_Integrity_Failures/)

Сбои целостности программного обеспечения и данных связаны с кодом и инфраструктурой, которые не защищают от нарушений целостности. 

Примером этого является ситуация, когда приложение использует плагины, библиотеки или модули из ненадежных источников, репозиториев и сетей доставки контента (CDN). Небезопасный конвейер CI/CD может привести к несанкционированному доступу, вредоносному коду или компрометации системы. Наконец, многие приложения теперь включают функцию автоматического обновления, при которой обновления загружаются без достаточной проверки целостности и применяются к ранее доверенному приложению. Злоумышленники потенциально могут загружать свои собственные обновления для распространения и запуска на всех установках. 

Другой пример — когда объекты или данные закодированы или сериализованы в структуру, которую злоумышленник может увидеть и изменить, она уязвима для небезопасной десериализации.

Как предотвратить:

* Используйте цифровые подписи или аналогичные механизмы для проверки того, что программное обеспечение или данные получены из ожидаемого источника и не были изменены.
* Убедитесь, что библиотеки и зависимости, такие как npm или Maven, используют доверенные репозитории. Если у вас профиль с более высоким риском, рассмотрите возможность размещения проверенного внутреннего заведомо исправного репозитория.
* Убедитесь, что инструмент безопасности цепочки поставок программного обеспечения, такой как OWASP Dependency Check или OWASP CycloneDX, используется для проверки того, что компоненты не содержат известных уязвимостей.
* Убедитесь, что существует процесс проверки изменений кода и конфигурации, чтобы свести к минимуму вероятность того, что вредоносный код или конфигурация могут быть внедрены в конвейер вашего программного обеспечения.
* Убедитесь, что ваш конвейер CI/CD имеет надлежащее разделение, конфигурацию и контроль доступа, чтобы обеспечить целостность кода, проходящего через процессы сборки и развертывания.
* Убедитесь, что неподписанные или незашифрованные сериализованные данные не отправляются ненадежным клиентам без какой-либо формы проверки целостности или цифровой подписи для обнаружения подделки или воспроизведения сериализованных данных.

Для данного блока уязвимостей в OWASP определили 10 CWE:

* CWE-345 Insufficient Verification of Data Authenticity
* CWE-353 Missing Support for Integrity Check
* CWE-426 Untrusted Search Path
* CWE-494 Download of Code Without Integrity Check
* CWE-502 Deserialization of Untrusted Data
* CWE-565 Reliance on Cookies without Validation and Integrity Checking
* CWE-784 Reliance on Cookies without Validation and Integrity Checking in a Security Decision
* CWE-829 Inclusion of Functionality from Untrusted Control Sphere
* CWE-830 Inclusion of Web Functionality from an Untrusted Source
* CWE-915 Improperly Controlled Modification of Dynamically-Determined Object Attributes

------------------------------------------------------------

#### A09:2021-Security Logging and Monitoring Failures

[Source](https://owasp.org/Top10/A09_2021-Security_Logging_and_Monitoring_Failures/)

Возвращаясь к OWASP Top 10 2021, эта категория предназначена для помощи в обнаружении, эскалации и реагировании на активные нарушения. Без регистрации и мониторинга нарушения не могут быть обнаружены. Недостаточное ведение журнала, обнаружение, мониторинг и активное реагирование происходят в любое время:

* События, подлежащие аудиту, такие как входы в систему, неудачные попытки входа и транзакции с высокой стоимостью, не регистрируются.
* Предупреждения и ошибки не генерируют, неадекватные или неясные сообщения журнала.
* Журналы приложений и API не проверяются на подозрительную активность.
* Журналы хранятся только локально.
* Соответствующие пороги оповещения и процессы эскалации реагирования не установлены или неэффективны.
* Тестирование на проникновение и сканирование с помощью инструментов динамического тестирования безопасности приложений (DAST) (таких как OWASP ZAP) не вызывают предупреждения.
* Приложение не может обнаруживать, эскалировать или предупреждать об активных атаках в режиме реального или близкого к реальному времени.

Вы уязвимы к утечке информации, делая события регистрации и оповещения видимыми для пользователя или злоумышленника (см. A01:2021-Broken Access Control).

Как предотвратить:

* Убедитесь, что все ошибки входа в систему, контроля доступа и проверки ввода на стороне сервера могут быть зарегистрированы с достаточным пользовательским контекстом для выявления подозрительных или злонамеренных учетных записей и удерживаться в течение достаточного времени для проведения отложенного криминалистического анализа.
* Убедитесь, что журналы создаются в формате, удобном для использования решениями по управлению журналами.
* Убедитесь, что данные журнала закодированы правильно, чтобы предотвратить инъекции или атаки на системы ведения журнала или мониторинга.
* Обеспечьте контрольный журнал важных транзакций с элементами управления целостностью для предотвращения подделки или удаления, например таблицы базы данных только для добавления и т.п.
* Команды DevSecOps должны установить эффективный мониторинг и оповещение, чтобы обнаруживать подозрительные действия и быстро реагировать на них.
* Разработайте или примите план реагирования на инциденты и восстановления, такой как Национальный институт стандартов и технологий (NIST) 800-61r2 или более поздней версии.

Существуют коммерческие платформы и платформы защиты приложений с открытым исходным кодом, такие как OWASP ModSecurity Core Rule Set, и программное обеспечение для корреляции журналов с открытым исходным кодом, такое как стек Elasticsearch, Logstash, Kibana (ELK), которые имеют настраиваемые информационные панели и оповещения.

Для данного блока уязвимостей в OWASP определили 4 CWE:

* CWE-117 Improper Output Neutralization for Logs
* CWE-223 Omission of Security-relevant Information
* CWE-532 Insertion of Sensitive Information into Log File
* CWE-778 Insufficient Logging

------------------------------------------------------------

#### A10:2021-Server-Side Request Forgery

[Source](https://owasp.org/Top10/A10_2021-Server-Side_Request_Forgery_%28SSRF%29/)

Ошибки SSRF возникают всякий раз, когда веб-приложение извлекает удаленный ресурс без проверки предоставленного пользователем URL-адреса. Это позволяет злоумышленнику заставить приложение отправить созданный запрос в неожиданное место назначения, даже если оно защищено брандмауэром, VPN или другим типом списка управления доступом к сети (ACL).

Поскольку современные веб-приложения предоставляют конечным пользователям удобные функции, получение URL-адреса становится распространенным сценарием. В результате заболеваемость SSRF увеличивается. Кроме того, серьезность SSRF становится выше из-за облачных сервисов и сложности архитектур.

Как предотвратить:

Разработчики могут предотвратить SSRF, внедрив некоторые или все следующие средства глубокоэшелонированной защиты:

1. С сетевого уровня:
	
	* Сегментируйте функции удаленного доступа к ресурсам в отдельных сетях, чтобы уменьшить влияние SSRF.
	* Применяйте политики брандмауэра «запретить по умолчанию» или правила управления доступом к сети, чтобы блокировать весь трафик, кроме основного внутрисетевого трафика.
		_Подсказки:_
		~ Установите права собственности и жизненный цикл правил брандмауэра на основе приложений.
		~ Зарегистрируйте все принятые и заблокированные сетевые потоки на брандмауэрах (см. A09:2021-Ведение журнала безопасности и мониторинг сбоев).

2. Из прикладного уровня:
	
	* Дезинфекция и проверка всех входных данных, предоставленных клиентом
	* Принудительно применяйте схему URL, порт и место назначения с помощью положительного списка разрешений.
	* Не отправляйте необработанные ответы клиентам
	* Отключить HTTP-перенаправления
	* Помните о согласованности URL-адресов, чтобы избежать таких атак, как повторная привязка DNS и условия гонки «время проверки, время использования» (TOCTOU).

	Не ограничивайте SSRF с помощью запрещенного списка или регулярного выражения. У злоумышленников есть списки полезной нагрузки, инструменты и навыки для обхода запрещенных списков.

3. Дополнительные меры для рассмотрения:

	* Не развертывайте другие службы безопасности на подставных системах (например, OpenID). Контролируйте локальный трафик в этих системах (например, localhost)
	* Для интерфейсов с выделенными и управляемыми группами пользователей используйте сетевое шифрование (например, VPN) в независимых системах, чтобы учесть очень высокие потребности в защите.

Для данного блока уязвимостей в OWASP определили 1 CWE:

* CWE-918 Server-Side Request Forgery (SSRF)
------------------------------------------------------------

### 2. Как работает веб-сервис.
	(Опишите процессы, происходящие от ввода в URL строку google.com, до получение страницы поисковика. Какие атаки на каждом из этапов могут быть реализованы?)

### 3. SQL-Injection.
	Какие виды SQL-инъекций вы знаете? Расскажите о них.

__Виды внедрения SQL:__

* Получение скрытых данных (Retrieving hidden data), где вы можете изменить запрос SQL, чтобы получить дополнительные результаты.
* Подрыв логики приложения (Subverting application logic), когда вы можете изменить запрос, чтобы он мешал логике приложения.
* Атаки UNION (UNION attacks), когда вы можете получить данные из разных таблиц базы данных.
* Изучение базы данных (Examining the database), откуда можно извлечь информацию о версии и структуре базы данных.
* Слепая инъекция SQL (Blind SQL injection), при которой результаты запроса, которым вы управляете, не возвращаются в ответах приложения.

__Где можно обнаружить:__

- Фильтрация
- Формы авторизации
- Формы комментариев / обратной связи
- Любые другие запросы подразумевающие обработку оператором WHERE.
- Когда результаты SQL-запроса возвращаются в ответах приложения.
- Числовые параметры, передаваемые со страницы, в функции backend-а.

__Как проверить наличие уязвимости:__

Внедрение SQL можно обнаружить вручную с помощью систематического набора тестов для каждой точки входа в приложение. Обычно это включает:

1. Отправка символа одинарной кавычки ' (или двойной ") и поиск ошибок или других аномалий.
2. Отправка определенного синтаксиса SQL, который оценивает базовое (исходное) значение точки входа и другое значение, и поиск систематических различий в результирующих ответах приложения (комментирование параметров).
3. Отправка логических условий, таких как OR 1=1 и OR 1=2, и поиск различий в ответах приложения.
4. Отправка полезных данных, предназначенных для инициирования временных задержек при выполнении в SQL-запросе, и поиск различий во времени, необходимом для ответа.
5. Отправка полезных данных OAST, предназначенных для запуска внеполосного сетевого взаимодействия при выполнении в запросе SQL, и отслеживание любого получающегося взаимодействия.

__Где можно использовать:__

Большинство уязвимостей SQL-инъекций возникают в предложении WHERE запроса SELECT.

Наиболее распространенными другими местами, где возникает SQL-инъекция, являются:

* В операторах UPDATE в обновленных значениях или предложении WHERE.
* В инструкциях INSERT внутри вставленных значений.
* В операторах SELECT внутри имени таблицы или столбца.
* В операторах SELECT в предложении ORDER BY.

__Как предотвратить SQLi__

Большинство случаев SQL-инъекций можно предотвратить, используя ___параметризованные запросы___ (также известные как подготовленные запросы) вместо объединения строк в запросе.

Их нельзя использовать для обработки ненадежных входных данных в других частях запроса, таких как имена таблиц или столбцов или предложение ORDER BY. 

Функциональность приложения, которая помещает ненадежные данные в эти части запроса, должна будет использовать другой подход, например, внести в белый список разрешенные входные значения или использовать другую логику для обеспечения требуемого поведения.

Чтобы параметризованный запрос был эффективным для предотвращения SQL-инъекций, строка, используемая в запросе, всегда должна быть жестко запрограммированной константой и никогда не должна содержать никаких переменных данных из любого источника. Ранее надежные источники могут становаться не надежными из-за ошибок в новом коде приложения.

--------------------------------------------------------------

#### Retrieving hidden data SQLi

Наличие SQL-запроса в явном виде без выполнения проверок SQL-запросов передаваемых на backend.

##### Как проверить наличие уязвимости

Доваить к запросу конструкцию вида:

	'+OR+1=1-- или 
	%27%20OR%201%3D1-- или 
	"+OR+1=1-- или 
	%22%20OR%201%3D1--

Запрос должен исполниться. Если изменить равенство на 1=2, то запрос не исполнится. 

Обращаем внимание на ковычки (двойные/одинарные)

##### Варианты эксплуатации

Использование в URL при GET-запросе:

	https://0ac90091048b26a3c221d5db003b0034.web-security-academy.net/filter?category=Lifestyle" OR 1=1--

##### Особенности

Возможна как правило при очень низком уроване безопасности приложения.
--------------------------------------------------------------

#### Subverting application logic SQLi

SQL-инъекция, используемая для изменния логики работы приложения. 

Например, в формах авторизации обход проверки.

##### Варианты эксплуатации

Ввести в поле авторизации:
	
	login: administrator'--
	password:123123123123
	
Аналогично в GET-запросе:

	https://0af3006804f1a5c7c21a354d00fa00cd.web-security-academy.net/login?login=administrator'--&password=123123123123

##### Особенности

Для эксплуатации уязвимости нужно понимание логики работы приложения.

--------------------------------------------------------------

#### SQLi UNION attacks

В случаях, когда результаты SQL-запроса возвращаются в ответах приложения, злоумышленник может использовать уязвимость SQL-инъекции для извлечения данных из других таблиц в базе данных. 

Это делается с помощью ключевого слова UNION, которое позволяет выполнить дополнительный запрос SELECT и добавить результаты к исходному запросу.

	SELECT a, b FROM table1 UNION SELECT c, d FROM table2
	
Этот SQL-запрос вернет один результирующий набор с двумя столбцами, содержащими значения из столбцов a и b в таблице1 и столбцов c и d в таблице2.

Чтобы выполнить атаку UNION с внедрением SQL-кода, вам необходимо убедиться, что ваша атака соответствует этим двум требованиям. Обычно это включает в себя выяснение:

1. Сколько столбцов возвращается из исходного запроса?
2. Какие столбцы, возвращенные исходным запросом, имеют подходящий тип данных для хранения результатов внедренного запроса?

##### Варианты эксплуатации

1. Определение количества столбцов, необходимых для атаки UNION с SQL-инъекцией:

		' ORDER BY 1--
		' ORDER BY 2--
		' ORDER BY 3--
		etc. до тех пор пока не появиться ошибка, типа "The ORDER BY position number 3 is out of range of the number of items in the select list."

	или:

		' UNION SELECT NULL--
		' UNION SELECT NULL,NULL--
		' UNION SELECT NULL,NULL,NULL--
		etc. до тех пор пока не появиться ошибка, типа "All queries combined using a UNION, INTERSECT or EXCEPT operator must have an equal number of expressions in their target lists."

	Приложение может на просто вернуть общую ошибку или никаких результатов. 

	Когда количество пустых значений совпадает с количеством столбцов, база данных возвращает дополнительную строку в результирующем наборе, содержащую нулевые значения в каждом столбце. 

	Влияние на результирующий HTTP-ответ зависит от кода приложения. Если вам повезет, вы увидите дополнительный контент в ответе, например дополнительную строку в таблице HTML. В противном случае нулевые значения могут вызвать другую ошибку, например исключение NullPointerException. В худшем случае ответ может быть неотличим от ответа, вызванного неправильным количеством нулей, что делает этот метод определения количества столбцов неэффективным.

2. Поиск столбцов с полезным типом данных в атаке UNION с SQL-инъекцией:

	Например, если запрос возвращает два столбца и вы хотите найти строковые значения, вы должны отправить:

		' UNION SELECT 'a',NULL --
		' UNION SELECT NULL,'a' --

	Если ошибка не возникает, а ответ приложения содержит некоторое дополнительное содержимое, включая введенное строковое значение, то соответствующий столбец подходит для получения строковых данных.

3. Использование UNION-атаки SQL-инъекции для извлечения интересных данных:

		' UNION SELECT username, password FROM users--

4. Получение нескольких значений в одном столбце:

		' UNION SELECT username || '~' || password FROM users--

##### Особенности

* Причина использования NULL в качестве значений, возвращаемых из внедренного запроса SELECT, заключается в том, что типы данных в каждом столбце должны быть совместимы между исходным и внедренным запросами. Поскольку значение NULL может быть преобразовано во все часто используемые типы данных, использование NULL увеличивает вероятность того, что полезная нагрузка будет успешной, если количество столбцов правильное.

* В Oracle каждый запрос SELECT должен использовать ключевое слово FROM и указывать допустимую таблицу. В Oracle есть встроенная таблица, называемая DUAL, которую можно использовать для этой цели. Таким образом, введенные запросы в Oracle должны выглядеть так:

	' UNION SELECT NULL FROM DUAL--

* Описанные полезные нагрузки используют последовательность комментариев с двойным тире, чтобы закомментировать оставшуюся часть исходного запроса после точки внедрения. В MySQL за последовательностью двойных дефисов должен следовать пробел. Кроме того, для обозначения комментария можно использовать символ решетки #.

--------------------------------------------------------------

#### Examining the database SQLi

Используется для получения информации о самой базе данных. 

Эта информация часто может проложить путь для дальнейшей эксплуатации.

Вы можете запросить сведения о версии для базы данных. 

То, как это делается, зависит от типа базы данных, поэтому вы можете сделать вывод о типе базы данных, исходя из того, какой метод работает. 

##### Варианты эксплуатации

1. Запрос типа и версии базы данных:

		Oracle: 	' UNION SELECT banner FROM v$version
				' UNION SELECT version FROM v$instance
		Microsoft: 	' UNION SELECT @@version
		PostgreSQL: 	' UNION SELECT version()
		MySQL:	 	' UNION SELECT @@version

2. Список содержимого базы данных:

	Большинство типов баз данных (за заметным исключением Oracle) имеют набор представлений, называемых информационной схемой, которые предоставляют информацию о базе данных.

		SELECT * FROM information_schema.tables
		
	Затем вы можете запросить information_schema.columns, чтобы получить список столбцов в отдельных таблицах:

		SELECT * FROM information_schema.columns WHERE table_name = 'Users'

	Эквивалент информационной схемы в Oracle:

		SELECT * FROM all_tables
		SELECT * FROM all_tab_columns WHERE table_name = 'USERS'

--------------------------------------------------------------

#### Blind SQLi

Когда приложение не возвращает результаты SQL-запроса или сведения об ошибках базы данных в своих ответах.

В зависимости от характера уязвимости и используемой базы данных могут использоваться следующие методы:

* Изменение логики запроса, чтобы инициировать обнаруживаемую разницу в ответе приложения в зависимости от истинности одного условия. Это может включать введение нового условия в некоторую логическую конструкцию или условный запуск ошибки, такой как деление на ноль.
* Активация временной задержки при обработке запроса, что позволит вам сделать вывод об истинности условия на основе времени, которое требуется приложению для ответа.
* Инициация внешнего сетевого взаимодействия, используя методы OAST (Out-of-band application security testing). Работает в ситуациях, когда другие техники не работают. Часто вы можете напрямую эксфильтровать данные через внеполосный канал, например, поместив данные в поиск DNS для домена, который вы контролируете.

--------------------------------------------------------------

### 4. Cross Site Scripting (XSS)
	* Какие виды XSS вы знаете? Расскажите о них.
	* Как защищаться от XSS.
	* Какие методы обхода фильтрации XSS вам известны?
	* Что отличает DOM XSS от хранимой XSS (помимо факта работы непосредственно с DOM)?

*XSS (Cross-Site Scripting)* – одна из наиболее часто встречающихся уязвимостей. Суть уязвимости сводится к внедрению вредоносного кода на страницу и его дальнейшее исполнение с целью получения какого-то конкретного результата, зависит от типа XSS и фантазии злоумышленника.


#### Разновидности XSS

1. Хранимые (Stored) XSS

	Возникают, когда приложение получает данные из ненадежного источника и небезопасным образом включает эти данные в свои последующие HTTP-ответы.

	Соответствующие данные могут быть отправлены в приложение через HTTP-запросы. Например, комментарии к сообщению в блоге, псевдонимы пользователей в чате или контактные данные в заказе клиента. В других случаях данные могут поступать из других небезопасных источников. 

	Например, приложение веб-почты, отображающее сообщения, полученные через SMTP, маркетинговое приложение, отображающее сообщения в социальных сетях, или приложение для мониторинга сети, отображающее пакетные данные из сетевого трафика.

2. Отражённые (reflected) XSS 

	Это простейшая разновидность межсайтового скриптинга. Они возникают, когда приложение получает данные в HTTP-запросе и включает эти данные в ответ небезопасным способом.

	Допустим есть приложение, которое позволяет ввести в форму Status любое сообщение. Введённое вами также отразится в строке адреса.

		https://example.com/status?message=I+am+okey.
	    \<p>Status: I am okey.\</p>

	Так как приложение никак не обрабатывает входящие данные то злоумышленник может отправить запрос, который будет включать в себя вредоносный код.

		\<p>Status: \<script> *Вредонос...* \</script>\</p>   

		https://example.com/status?message= \<script> *Вредонос...+* \</script> 

	Если пользователь зайдёт по такому адресу, скрипт злоумышленника исполнится в браузере жертвы и ничего хорошего точно не будет.

3. DOM-модели (DOM-based XSS)

	Возникают, когда приложение содержит некоторый клиентский JavaScript, который обрабатывает данные из ненадежного источника небезопасным способом, обычно путем записи данных обратно в DOM.

	Допустим, есть приложение, которое получает значение от пользователя и присваивает его элементу HTML.

		var search = document.getElementById('search').value;
		var results = document.getElementById('results');
		results.innerHTML = 'You searched for: ' + search;

	Таким образом, злоумышленник может ввести такое значение, которое приведёт к исполнению нужного ему кода:

		You searched for: \<img src=1 onerror=' *Bad stuff here...*'>

#### Защита от XSS

Если кратко, двумя самыми популярными способами защиты от XSS являются:

* Флаг HttpOnly — запрещает доступ к файлу cookie.
* Фильтрация — изменение данных, введенных пользователем, с целью повышения уровня безопасности.
* Использование соответствующих заголовков ответа (Content-Type и X-Content-Type-Options).
* Использование Политики безопасности контента (CSP).

#### Методы обхода фильтрации XSS

1. Использование кодировки символов

	Самый простой вектор XSS, используемый для отмены фильтров, основан на кодировании символов, которые могут запускать фильтр. Вы можете использовать разные методы кодирования, например, base64, HTML-сущности или другие.

2. Манипулирование регистром и вставка символов

	Если фильтр чувствителен к регистру, его можно обмануть, если вы используете регистр, отличный от ожидаемого. Например, вы можете использовать \<SCRIPT>, \<Script> или даже \<sCrIpT>.

3. Обман регулярных выражений

	Иногда для обхода фильтра требуется лишь найти способ обмануть регулярное выражение.

	Например, использовать поддельные теги в скобках:
		
		<script a = ">" src = "http://example.com/xss.jpg"> </script>.

4. Использование нетипичных обработчиков событий

	Хотя многие фильтры XSS проверяют потенциальный JavaScript на наличие типичных обработчиках событий, таких как onmouseover, onclick, onerror, onfocus или onload, есть много других обработчиков событий, которые вы можете попробовать использовать, например, обработчики событий, связанные с выделением, такие как onstart и onfinish, и многое другое.

5. Уловки с тегами и атрибутами

	Некоторые фильтры ориентированы только на общие теги. Поэтому вы можете использовать необычные теги, чтобы их обойти, например \<svg>. Однако фильтры часто забывают включать такие очевидные теги, как \<body onload = alert (document.cookie)>.

6. Использование нетипичных разделителей

	Есть несколько символов, которые можно использовать в качестве разделителей вместо пробелов - современные браузеры по-прежнему будут правильно выполнять код. Например, вы можете использовать двойные кавычки, одинарные кавычки и даже обратные кавычки (только для некоторых браузеров).

7. Совершение других преднамеренных ошибок

	Хотя преднамеренные ошибки могут помочь вам обойти многие фильтры, браузеры все равно поймут контекст. Это особенно верно, когда вы используете кавычки не в том месте, в неправильном порядке или забываете закрыть кавычки.

https://wiki.owasp.org/index.php/XSS_Filter_Evasion_Cheat_Sheet

#### Отлиичия DOM XSS от хранимых и отраженных

Динамическое изменение страницы при DOM XSS, следовательно анализ исходного кода страницы бесполезен. Работаем только через инструменты разработчика в браузере

Така используются атрибуты DOM, то необходимо искать способы выхода из них.

Разные браузеры - разная работа с DOM. Некоторые браузеры кодируют атрибуты в URL-адресе перед их отправкой, в таком случае атака не пройдёт.

При работе с JS скорее всего придётся использовать отладчик, чтобы обнаружить место чтения исходного кода и проследить дальнейшее использование вводимых данных.

Последствия такие же, как у типичного XSS, только способы доставки отличаются.

По сравнению с другими уязвимостями межсайтового скриптинга (отраженными и сохраненными XSS), где необработанный параметр передается сервером, возвращается пользователю и выполняется в контексте браузера пользователя, уязвимость XSS на основе DOM контролирует потоковый код, используя элементы объектной модели документа (DOM) вместе с кодом, созданным злоумышленником для изменения потока.

Black Box тестирование данного типа уязвимости обычно не проводится ввиду необходимости доступа к исходному коду.

Пользовательский ввод бывает двух основных форм:

1. Ввод записывается на страницу сервером способом, не допускающим прямого XSS.
2. Ввод, полученный от клиентских объектов JavaScript.

Необходимо проводить ручное тестирование, которое может быть выполнено путем изучения областей в коде, к которым относятся параметры, которые могут быть полезны для злоумышленника. Примеры таких областей включают места, где код динамически записывается на страницу, и другие места, где модифицируется DOM или даже, где скрипты выполняются напрямую.

### 5. Path Treversal и File Inclusion.
	Расскажите в чём разница между уязвимостями path treversal и file inclusion. Что опаснее и почему?

### 6. Опишите методику проведения пентеста. 
	Указать этапы, набор утилит, которые вы будете использовать на каждом из этапов, а также пояснение, как вы будете использовать найденную на каждом из этапов информацию в дальнейшем.

### 7. Модель OSI и описание служб работающих на каждом уровне.

Модель OSI - эталонная модель сетевого взаимодействия. [Ссылка на Wikipedia](https://ru.wikipedia.org/wiki/%D0%A1%D0%B5%D1%82%D0%B5%D0%B2%D0%B0%D1%8F_%D0%BC%D0%BE%D0%B4%D0%B5%D0%BB%D1%8C_OSI)

В данной модели описано 7 уровней, которые принято изображать снизу вверх:

7. Прикладной (application) - Данные (HTTP, FTP, POP3, SMTP, WebSocket, TELNET, SSH, RDP) 
6. Представления (presentation) - Данные (ASCII, JPEG, MIDI)
5. Сеансовый (session) - Данные (RPC, PAP, L2TP, H.245, NetBIOS, SCP, PPTP, RTCP)
4. Транспортный (transport)  - Сегменты/Датаграммы (TCP, UDP, SCTP, Ports)
3. Сетевой (network) - Пакеты (IPv4, IPv6, IPsec, AppleTalk, ICMP)
2. Канальный (data link) - Кадры (PPP, Ethernet, IEEE 802.22, DSL, ARP)
1. Физический (physical) - Биты (USB, RJ, Radio Signals, IEEE 802.11 Wi-Fi)

### 8. Известные вам методики тестирования.
	Опишите их область применения и ключевые отличия.
	Что вам известно о Cyber-Kill Chain?

Различают 3 метода проведения тестирования:

* Метод "Белого Ящика". В этой группе тестов у испытателя имеется полная инфомрация о тестируемой системе и доступ ко всем её компонентам, иногда даже к учётным данным. Обычно проводиться для проверки новых приложений перед их вводом в эксплуатацию, а также в рамках жизненного цикла системы (SDLC).
* Метод "Чёрного Ящика". В этой группе тестов у испытателя нет информации о системе, учётных данных, прав доступа к объекту. Вся доступная информация, как правило сводиться к Названию организации или IP-адресу сервиса. Данный вид тестов в наибольшей степени похож на настоящие атаки хакеров. Самы сложний, долговременный и дорогой вид тестов.
* Метод "Серого Ящика". В этой группе тестов испытателю доступна только ограниченная информация, позволяющая провести внешнюю атаку на систему. Обычно выполняются в ограниченном объёме, когда испытатель немного знает о системе.

Наиболее популярные методики (методологии) проведения тестирования:

[Руководство по методологии тестирования безопасности](https://www.isecom.org/research.html#content5-9d) с открытым исходным кодом (OSSTMM).
[Открытый проект безопасности веб-приложений](https://owasp.org/www-project-top-ten/) (OWASP).
[Стандарт выполнения испытаний на проникновение](http://www.pentest-standard.org/index.php/Main_Page) (PTES).
[База знаний MITRE ATT&CK](https://attack.mitre.org/) (не совсем методика).
[Information System Security Assessment Framework](http://cuchillac.net/archivos/pre_seguridad_pymes/2_hakeo_etico/lects/metodologia_oissg.pdf) (ISSAF).

* The Open Source Security Testing Methodology Manual (OSSTMM) — один из самых популярных стандартов, разработанный Institute for Security and Open Methodologies (ISECOM). Это универсальный стандарт, потому что может быть базовым руководством при проведении тестирования на проникновение.

	Методология предлагает пять основных каналов (направлений) для тестирования операционной безопасности:

	* Безопасность человека. Безопасность, которая напрямую зависит от физического, либо психологического взаимодействия людей.
	* Физическая безопасность. Любой материальный (не электронный) элемент безопасности, работа которого подразумевает физическое или электромеханическое воздействие.
	* Беспроводная связь. Безопасность всех беспроводных средств связи, от Wi-Fi до инфракрасных датчиков.
	* Телекоммуникации. В основном это касается телефонии, а также передачи служебной информации по телефонным линиям связи.
	* Сети передачи данных. Безопасность внутренних и внешних корпоративных сетей, интернет-подключений и сетевого оборудования.

* NIST SP800-115 (NIST Special Publications 800 Series) — стандарт информационной безопасности, разработанный National Institute of Standards and Technology. Это техническое руководство, которое можно применять для проверки уровня информационной безопасности организаций из различных сфер.

	В подразделе стандарта SP 800-115 описаны технические вопросы оценки уровня информационной безопасности, порядок проведения тестирования на проникновение, приведены рекомендации по анализу результатов и разработке мер по снижению рисков. Последняя версия документа уделяет большое внимание снижению рисков от кибератак.

* Open Web Application Security Project (OWASP) — открытое интернет-сообщество, которое предлагает самую исчерпывающую методологию для тестирования приложений, сайтов и API. 

	Одно из главных преимуществ OWASP в том, что методология описывает тестирование на каждой стадии жизненного цикла разработки приложений: определение требований, проектирование, разработка, внедрение и поддержка. При этом тестируются не только сами приложения, но и технологии, процессы, а также люди. Второе важное преимущество: OWASP могут применять как пентестеры, так и веб-разработчики.

* Information System Security Assessment Framework (ISSAF) разработан Open Information Systems Security Group (OISSG). Документ охватывает большое количество вопросов, связанных с информационной безопасностью. В ISSAF приведены подробные рекомендации по тестированию на проникновение. Описаны утилиты, которыми можно провести пентест, указания по их использованию, а также подробно разъяснено, какие результаты и при каких параметрах можно получить в результате тестирования.

	ISSAF считается достаточно сложной и подробной методологией, которую можно адаптировать для проверки информационной безопасности любой организации. Каждый этап тестирования согласно ISSAF тщательно документируется. Также даны рекомендации по использованию конкретных инструментов на каждом из этапов.

* Penetration Testing Methodologies and Standards (PTES) предлагает рекомендации для проведения базового пентеста, а также несколько расширенных вариантов тестирования, для организаций с повышенными требованиями к информационной безопасности. Одно из преимуществ PTES в том, что он дает подробное описание целей и ожиданий от пентеста.

	Основные этапы PTES:

	    * Обследование (Intelligence Gathering)
	    * Моделирование угроз
	    * Анализ уязвимостей
	    * Эксплуатация уязвимости
	    * Составление отчета

	В PTES также содержится руководство по выполнению повторного, или постэксплуатационного, тестирования. Это помогает определить, насколько эффективно были закрыты выявленные уязвимости.

#### Модель Cyber-Kill Chain

Модель Cyber-Kill Chain - Модель жизненного цикла кибератаки.

Наиболее популярное описание этапов проведения атаки с использованием данной модели:

1. Разведка -  Этот этап может быть определен как фаза выбора цели, выявления особенностей организации, специфических требований в данной отрасли, выбор технологий, изучения активности компании в соцсетях или через рассылки.
2. Вооружение -  Возможны различные формы: эксплуатация веб-приложения, стандартные или специально изготовленные вредоносные программы, уязвимости в различных документах (PDF, Office или другие форматы документов) или атаки типа watering hole.
3. Доставка -  Передача вредоносного контента либо по инициативе жертвы (например, пользователь заходит на вредоносный сайт, в результате чего передается вредоносная программ, или он открывает вредоносный PDF-файл), либо по инициативе хакера (SQL-инъекция или компрометация сетевой службы).
4. Заражение -  После доставки на компьютер или устройство пользователя, требуемый (вредоносный) контент разворачивается, устанавливаясь в окружении. Как правило, это происходит при использовании известной уязвимости, для которой ранее был доступен патч.
5. Установка -  Часто установка (внедрение) происходит на фоне каких-то внешних соединений. Обычно вредоносная программа скрывается в этих операциях, незаметно проникая на конечные точки, к которым можно получить доступ. Затем хакер может контролировать это приложение без ведома жертвы.
6. Получение управления -  На этом этапе хакеры начинают контролировать активы жертвы с помощью таких методов управления (как правило, удаленных), как DNS, Internet Control Message Protocol (ICMP), веб-сайты и социальные сети.
7. Выполнение действий -  На финальном этапе хакер отправляет собранные данные и/или выводит из строя ИТ-активы во время своего нахождения в сети жертвы. Затем проводятся мероприятия по выявлению других целей, расширению своего присутствия внутри организации и (что самое важное) извлечению данных.

### 9. Active Directory.
	* Что такое Active Directory? 
	* Для чего она нужна? 
	* Зачем ее используют?
	* Что такое дерево и лес, как они формируются?
	* Какие атаки на AD вам известны? (app-pass-the-hesh? woulden_tiket? kpk-accaunt (kerberos)?)

### 10. Знание Windows и Linux. 
	Вопросы по bash, демоны, логирование, администрирование, встроенные брендмауеры.

### 11. Пример системы для пентеста и описание полного алгоритма (логики проведения пентеста).

### 12. Отчёт.
	Что должно входить в отчет по результатам тестирования?


## Практические задания

1. Вам выдан доступ к удаленной станции по VPN. Ваша задача залогиниться на коммутаторе с IP-адресом _таким-то_ под пользователем _admin_. Брутить пароль бессмысленно, он длинный и сложный. Сканирование портов блокируется на 10 секунд.
2. Вам дан дамп сетевого трафика снятый между клиентом и веб-сервером. Первичная аутентификация строиться на основании HTTP аутентификации. Проверьте безопасно ли реализована аутентификация и получите передаваемые данные.

## Решения практических заданий
