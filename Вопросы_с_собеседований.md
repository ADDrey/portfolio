# Вопросы с собеседований на вакансию Pentester (Специалист по тестированию на проникновение)

## Вопросы

1. Знаете ли вы что такое OWASP TOP 10. Если да, расскажите про какой-либо из пунктов. В чем значимость этих уязвимостей. Типи подуязвимостей. Примеры.
2. Опишите процессы, происходящие от ввода в URL строку google.com, до получение страницы поисковика (как работает веб-сервис?) Какие атаки на каждам из этапов могут быть реализованы?
3. Какие виды SQL-инъекций вы знаете? Расскажите о них.
4. Какие виды XSS вы знаете? Расскажите о них.
5. Расскажите в чём разница между уязвимостями path treversal и file inclusion. Что опаснее и почему?
6. Что отличает DOM XSS от хранимой XSS (помиимо факта работы непосрдественно с DOM)?
7. Опешите методику проведения пентеста. (Указать этапы, набор утилит, которые вы будете использовать на каждом из этапов, а также пояснение, как вы будете использовать найденную на каждом из этапов информацию в дальнейшем).
8. Модель OSI и описание служб работающих на каждом уровне.
9. Известные вам методологии тестирования. Опишити их область применения и ключевые отличия.
10. Что такое Active Directory? Для чего она нужна? Зачем ее используют? (Для использования ролевых моделей) Что такое дерево и лес, как они формируются? Какие атаки на AD вам известны? (app-pass-the-hesh? woulden_tiket? kpk-accaunt (kerberos)?)
11. Знание Windows и Linux. Вопросы по bash, демоны, логирование, администрирование, встроенные брендмауеры.
12. Пример системы для пентеста и описание полного алгоритма (логики проведения пентеста).
	- Модель тестирования (box).
	- Фишинг OSINT.
	- Закрепление в системе.
	- Дальнейшее проведение.
	- Результаты пентеста (подробный отчет с описаниме проблем, методов защиты и требований к зачистке информации за собой).
13. Что должно входить в отчет?

## Ответы

### 1. Знаете ли вы что такое OWASP TOP 10. Если да, расскажите про какой-либо из пунктов.

OWASP - Open Web Application Security Project (Открытый проект безопасности web-приложений) - это открытое сообщество, позволяющее организациям разрабатывать, приобретать и поддерживать безопасные приложения и интерфейсы прикладного программирования (API). Предоставляет стандарты, презентации, книги, видео, передовые исследования.

TOP 10 - Список из 10 самых популярных (частовстречающихся и опасных) уязвимостей в веб-приложениях. На 2021 год в них входят:

* А.01 - Недостатки контроля доступа (Broken Access Control). 94 % приложений были протестированы на предмет нарушения контроля доступа в той или иной форме. 34 Common Weakness Enumerations (CWEs), сопоставленные с Broken Access Control, чаще встречаются в приложениях, чем любая другая категория.
* А.02 - Сбои криптографии (Cryptographic Failures), ранее известное как раскрытие конфиденциальных данных, что было общим симптомом, а не основной причиной. Особое внимание здесь уделяется сбоям, связанным с криптографией, которые часто приводят к раскрытию конфиденциальных данных или компрометации системы.
* А.03 - Инъекции (Внедрения - Injection). 94 % приложений были протестированы на наличие той или иной формы внедрения, и 33 CWE, отнесенных к этой категории, занимают второе место по частоте появления в приложениях.
* А.04 - Не безопасный дизайн (Inesecure Design). Это новая категория, в которой основное внимание уделяется рискам, связанным с недостатками дизайна. Если мы действительно хотим «двигаться влево» как отрасль, это требует более широкого использования моделирования угроз, безопасных шаблонов и принципов проектирования, а также эталонных архитектур.
* А.05 - Некорректная настройка параметров бещзопасности (Security Misconfiguration). 90 % приложений были протестированы на наличие неправильной конфигурации в той или иной форме. Неудивительно, что с увеличением количества переходов на программное обеспечение с широкими возможностями настройки эта категория продвигается вверх.
* А.06 - Уязвимые и устаревшие компоненты (Vulnerable and Outdated Components). Это единственная категория, в которой никакие распространенные уязвимости и воздействия (CVE) не сопоставлены с включенными CWE, поэтому в их оценках учитываются эксплойт и веса воздействия по умолчанию, равные 5,0.
* А.07 - Ошибки (Сбои) идентифиакции и аутентификации (Identification and Authentication Failures). Эта категория по-прежнему является неотъемлемой частью Топ-10, но, похоже, этому способствует повышенная доступность стандартизированных фреймворков. 
* А.08 - Сбои целостности программного обеспечения и данных (Software and Data Integrity Failures). Это новая категория, в которой основное внимание уделяется предположениям, связанным с обновлениями программного обеспечения, критическими данными и конвейерами CI/CD без проверки целостности. Одно из самых взвешенных воздействий данных Common Vulnerability and Exposures/Common Vulnerability Scoring System (CVE/CVSS), сопоставленных с 10 CWE в этой категории. Небезопасная десериализация из 2017 года теперь является частью этой более широкой категории.
* А.09 - Сбои ведения журнала и мониторинга безопасности (Security Logging and Monitoring Failures). Эта категория расширена за счет включения большего количества типов сбоев, сложна для тестирования и недостаточно хорошо представлена в данных CVE/CVSS. Однако сбои в этой категории могут напрямую повлиять на видимость, оповещение об инцидентах и судебную экспертизу.
* А.10 - Подделка запросов на стороне сервера (Server-Side Request Forgery - SSRF). Данные показывают относительно низкий уровень заболеваемости при охвате тестированием выше среднего, а также выше среднего рейтинга потенциала использования и воздействия. Эта категория представляет собой сценарий, в котором члены сообщества безопасности говорят нам, что это важно, хотя в настоящее время это не проиллюстрировано в данных.

#### Подробнее о пунктах ТОП-10 с указанием атак

------------------------------------------------------------

##### A01:2021-Broken Access Control 

[Source](https://owasp.org/Top10/A01_2021-Broken_Access_Control/)

Контроль доступом определяет политику таким образом, чтобы пользователи не могули действовать за пределами своих предполагаемых разрешений. Сбои обычно приводят к НСД или к выполнению бизнес-функции за пределами полномочий пользователя. Общие уязвимости контроля доступа включают в себя:

* Нарушение принципа наименьших привилегий или запрета по умолчанию, когда доступ должен предоставляться только для определенных возможностей, ролей или пользователей, но доступен всем.
* Обход проверок управления доступом путем изменения URL-адреса (изменение параметров или принудительный просмотр), внутреннего состояния приложения или HTML-страницы либо с помощью инструмента атаки, изменяющего запросы API.
* Разрешение просмотра или редактирования чужой учетной записи путем предоставления ее уникального идентификатора (небезопасные прямые ссылки на объекты)
* Доступ к API с отсутствующими элементами управления доступом для POST, PUT и DELETE.
* Повышение привилегий. Работа в качестве пользователя без входа в систему или в качестве администратора при входе в систему в качестве пользователя.
* Манипуляции с метаданными, такие как воспроизведение или подделка маркера управления доступом JSON Web Token (JWT), а также использование файла cookie или скрытого поля для повышения привилегий или злоупотребления аннулированием JWT.
* Неправильная конфигурация CORS (Cross-origin resource sharing) разрешает доступ к API из неавторизованных/ненадежных источников.
* Принудительный просмотр аутентифицированных страниц в качестве неаутентифицированного пользователя или привилегированных страниц в качестве обычного пользователя.

Как предотвратить:
* Запрещать по умолчанию все ресурсы, за исключением общедоступных.
* Реализовать механизмы управления доступом один раз и повторно использовать их во всем приложении, включая минимизацию использования общего доступа к ресурсам между источниками (CORS).
* Элементы управления доступом модели должны обеспечивать право собственности на записи, а не допускать, чтобы пользователь может создавать, читать, обновлять или удалять любую запись.
* Требования к бизнес-пределам уникальных приложений должны обеспечиваться моделями предметной области.
* Отключите список каталогов веб-сервера и убедитесь, что метаданные файлов (например, .git) и файлы резервных копий отсутствуют в корнях веб-сайтов.
* Регистрируйте сбои управления доступом, предупреждайте администраторов, когда это необходимо (например, повторяющиеся сбои).
* Ограничьте скорость доступа к API и контроллеру, чтобы свести к минимуму вред от автоматизированных инструментов атаки.
* Идентификаторы сеансов с отслеживанием состояния должны быть аннулированы на сервере после выхода из системы. Жетоны JWT без сохранения состояния должны быть недолговечными, чтобы свести к минимуму окно возможностей для злоумышленника. Для более долгоживущих JWT настоятельно рекомендуется следовать стандартам OAuth для отзыва доступа.

Для данного блока уязвимостей в OWASP определили 34 CWE (подробнее можно посмотреть в источнике), здесь же приведены наиболее простые/популярные:
* Path Traversal
* Permission Issuse
* Cross-Site Request Forgery (CSRF)
* Insecure Temporary File
* Open Redirect
* Missing/Incorrect Authorization

------------------------------------------------------------

##### A02:2021-Cryptographic Failures

[Source](https://owasp.org/Top10/A02_2021-Cryptographic_Failures/)

Прежде всего, необходимо определить потребности в защите данных при передаче и хранении. Например, пароли, номера кредитных карт, медицинские записи, личная информация и коммерческая тайна требуют дополнительной защиты, в основном, если эти данные подпадают под действие законов о конфиденциальности, например, Общего регламента ЕС по защите данных (GDPR), или нормативных актов, например, о защите финансовых данных. например стандарт безопасности данных PCI (PCI DSS). 

Чем может провацироваться уязвимость:

* Передача данных в открытом виде. Это касается таких протоколов, как HTTP, SMTP, FTP, а также использующих обновления TLS, такие как STARTTLS. Как во внутреннем взаимодействии, так и при работе с Интернетом.
* Использование старых или слабых криптографических алгоритмов или протоколы по умолчанию или в старом коде.
* Использование криптографических ключей по умолчанию, создание или повторное использоование слабых криптографических ключей, или отсутствие надлежащего управление ключами или их ротации. 
* Наличие криптоключей в репозиториях исходного кода.
* Не использование шифрования там где это необходимо, например, отсутствуют какие-либо директивы безопасности HTTP-заголовков (браузера) или заголовки.
* Некорректно проверяется полученный сертификат сервера и цепочка доверия.
* Векторы инициализации игнорируются, используются повторно или создаются недостаточно безопасно для криптографического режима работы. Используется небезопасный режим работы, такой как ECB. Используется простое шифрование, когда шифрование с проверкой подлинности является более подходящим.
* Используются пароли в качестве криптографических ключей при отсутствии функции получения ключа на основе пароля.
* Используется случайность в криптографических целях, не предназначенных для удовлетворения криптографических требований. В правильной криптографической функции перезаписана разработчиком встроенная в нее надежную функция  заполнения исходным кодом, которому не хватает энтропии/непредсказуемости.
* Используются устаревшие хеш-функции, такие как MD5 или SHA1, или используются некриптографические хеш-функции, когда нужны криптографические хеш-функции.
* Используются устаревшие методы криптографического заполнения, такие как PKCS номер 1 v1.5.
* Неумесное использование сообщений об ошибках с криптографией или информационных сообщений по сторонним каналам, например, в форме атак оракула заполнения.

Как предотвратить:

* Классифицировать данные, обрабатываемые, сохраняемые или передаваемые приложением. Определите, какие данные являются конфиденциальными в соответствии с законами о конфиденциальности, нормативными требованиями или потребностями бизнеса.
* Не храните конфиденциальные данные без необходимости. Откажитесь от этого как можно скорее или используйте токенизацию или даже усечение в соответствии с PCI DSS. Данные, которые не сохраняются, не могут быть украдены.
* Обязательно зашифруйте все хранимые конфиденциальные данные.
* Обеспечьте наличие актуальных и надежных стандартных алгоритмов, протоколов и ключей; используйте правильное управление ключами.
* Шифруйте все передаваемые данные с помощью безопасных протоколов, таких как TLS с шифрованием прямой секретности (FS), приоритезацией шифров сервером и безопасными параметрами. Обеспечьте шифрование с помощью таких директив, как HTTP Strict Transport Security (HSTS).
* Отключите кэширование ответов, содержащих конфиденциальные данные.
* Примените необходимые меры безопасности в соответствии с классификацией данных.
* Не используйте устаревшие протоколы, такие как FTP и SMTP, для передачи конфиденциальных данных.
* Храните пароли, используя надежные адаптивные и соленые функции хеширования с коэффициентом работы (коэффициентом задержки), например Argon2, scrypt, bcrypt или PBKDF2.
* Всегда используйте шифрование с проверкой подленности (аутентифицированное), а не просто шифрование.
* Ключи должны генерироваться криптографически случайным образом и храниться в памяти в виде массивов байтов. Если используется пароль, то он должен быть преобразован в ключ с помощью соответствующей функции получения базового ключа пароля.
* Избегайте устаревших криптографических функций и схем заполнения, таких как MD5, SHA1, PKCS номер 1 v1.5.
* Самостоятельно проверяйте эффективность конфигурации и настроек.

Для данного блока уязвимостей в OWASP определили 29 CWE (подробнее можно посмотреть в источнике), здесь же приведены наиболее простые/популярные:

* Weak Encoding for Password
* Cryptographic Issuse
* Use of Hard-coded Cyptographic Key
* Use of a Broken or Risky Cryptographic Algorithm
* Unprotected Transport of Credentials
* Use of a One-Way Hash without a Salt (or Predictable Salt)

------------------------------------------------------------

##### A03:2021-Injection

[Source](https://owasp.org/Top10/A03_2021-Injection/)

Приложение уязвимо для атаки, когда:

* Введенные пользователем данные не проверяются, не фильтруются и не очищаются приложением.
* Динамические запросы или непараметризованные вызовы без контекстно-зависимого экранирования используются непосредственно в интерпретаторе.
* Враждебные данные используются в параметрах поиска объектно-реляционного сопоставления (ORM) для извлечения дополнительных конфиденциальных записей.
* Враждебные данные используются напрямую или объединяются. SQL или команда содержат структуру и вредоносные данные в динамических запросах, командах или хранимых процедурах.

Некоторые из наиболее распространенных инъекций (внедрений) — SQL, NoSQL, команда ОС, реляционное сопоставление объектов (ORM), LDAP и внедрение языка выражений (EL) или библиотеки навигации по графу объектов (OGNL). 

Концепция одинакова среди всех интерпретаторов. Проверка исходного кода — лучший способ определить, уязвимы ли приложения для инъекций. 

Настоятельно рекомендуется автоматическое тестирование всех параметров, заголовков, URL-адресов, файлов cookie, входных данных JSON, SOAP и XML. Организации могут включать статические (SAST), динамические (DAST) и интерактивные (IAST) инструменты тестирования безопасности приложений в конвейер CI/CD, чтобы выявлять внедренные недостатки перед развертыванием в рабочей среде.

Как предотвратить:

* Предпочтительным вариантом является использование безопасного API, который полностью исключает использование интерпретатора, предоставляет параметризованный интерфейс или переходит на средства объектно-реляционного сопоставления (ORM).
	_Примечание_. Даже если хранимые процедуры параметризованы, они все равно могут привести к SQL-инъекциям, если PL/SQL или T-SQL объединяют запросы и данные или выполняют враждебные данные с помощью EXECUTE IMMEDIATE или exec().
* Используйте положительную проверку ввода на стороне сервера. Это не полная защита, так как многие приложения требуют специальных символов, таких как текстовые области или API для мобильных приложений.
* Для любых остаточных динамических запросов экранируйте специальные символы, используя специальный синтаксис escape для этого интерпретатора.
	_Примечание_. Структуры SQL, такие как имена таблиц, имена столбцов и т. д., не могут быть экранированы, поэтому имена структур, предоставляемые пользователем, опасны. Это распространенная проблема в программном обеспечении для написания отчетов.
* Используйте LIMIT и другие элементы управления SQL в запросах, чтобы предотвратить массовое раскрытие записей в случае внедрения SQL.

Для данного блока уязвимостей в OWASP определили 33 CWE (подробнее можно посмотреть в источнике), здесь же приведены наиболее простые/популярные:

* SQL and NoSQL Injection
* Cross Site Scripting (XSS)
* Command Injection and OS Command Injection
* CRLF Injection
* XPath Injection
* Unsafe Reflection

------------------------------------------------------------

##### A04:2021-Insecure Design

[Source](https://owasp.org/Top10/A04_2021-Insecure_Design/)

Небезопасный дизайн — это широкая категория, представляющая различные недостатки, выраженные как «отсутствующий или неэффективный дизайн элемента управления». Небезопасный дизайн не является источником всех остальных 10 категорий риска. Есть разница между небезопасным дизайном и небезопасной реализацией. Мы различаем недостатки дизайна и дефекты реализации по той причине, что у них разные первопричины и методы исправления. Безопасный дизайн все еще может иметь дефекты реализации, приводящие к уязвимостям, которые могут быть использованы. Небезопасный дизайн не может быть исправлен идеальной реализацией, поскольку по определению необходимые средства безопасности никогда не создавались для защиты от конкретных атак. Одним из факторов, способствующих небезопасному проектированию, является отсутствие профилирования бизнес-рисков, присущего разрабатываемому программному обеспечению или системе, и, следовательно, невозможность определить, какой уровень безопасности требуется.

Безопасный дизайн — это культура и методология, которые постоянно оценивают угрозы и обеспечивают надежную разработку и тестирование кода для предотвращения известных методов атак. Моделирование угроз должно быть интегрировано в сеансы уточнения (или аналогичные действия); ищите изменения в потоках данных и управлении доступом или других мерах безопасности.

Для безопасного программного обеспечения требуется безопасный жизненный цикл разработки, некоторая форма безопасного шаблона проектирования, методология проложенной дороги, защищенная библиотека компонентов, инструменты и моделирование угроз. Обратитесь к своим специалистам по безопасности в начале проекта программного обеспечения на протяжении всего проекта и обслуживания вашего программного обеспечения. Рассмотрите возможность использования модели OWASP Software Assurance Maturity Model (SAMM), чтобы структурировать свои усилия по разработке безопасного программного обеспечения.

Как предотвратить:

* Создайте и используйте безопасный жизненный цикл разработки вместе со специалистами AppSec, чтобы помочь оценить и разработать элементы управления, связанные с безопасностью и конфиденциальностью.
* Создавайте и используйте библиотеку безопасных шаблонов проектирования или готовых к использованию компонентов асфальтированной дороги.
* Используйте моделирование угроз для критической аутентификации, управления доступом, бизнес-логики и ключевых потоков.
* Интегрируйте язык безопасности и элементы управления в пользовательские истории.
* Интегрируйте проверки правдоподобия на каждом уровне вашего приложения (от интерфейса до сервера).
* Напишите модульные и интеграционные тесты, чтобы убедиться, что все критические потоки устойчивы к модели угроз. Скомпилируйте варианты использования и варианты неправильного использования для каждого уровня вашего приложения.
* Разделяйте многоуровневые уровни на системные и сетевые уровни в зависимости от требований к воздействию и защите.
* Надежно разделяйте арендаторов по дизайну на всех уровнях.
* Ограничить потребление ресурсов пользователем или службой.

Для данного блока уязвимостей в OWASP определили 40 CWE (подробнее можно посмотреть в источнике), здесь же приведены наиболее простые/популярные:

* Generation of Error Message Containing Sensitive Information
* Unprotected Storage of Credentials
* Use of Web Browser Cache/ Persistent Cookies Containing Sensitive Information
* External Control of Critical State Data
* Trusting HTTP Permition Methods on the Server Side
* Business Logic Error

------------------------------------------------------------

##### A05:2021-Security Misconfiguration

[Source](https://owasp.org/Top10/A05_2021-Security_Misconfiguration/)

Приложение может быть уязвимым, если в нём:

* Отсутствует надлежащее усиление безопасности в любой части стека приложений или неправильно настроенны разрешения для облачных сервисов.
* Включены или установлены ненужные функции (например, ненужные порты, службы, страницы, учетные записи или привилегии).
* Учетные записи по умолчанию и их пароли по-прежнему включены и не изменяются.
* Обработка ошибок показывает трассировку стека или другие слишком информативные сообщения об ошибках для пользователей.
* В обновленных системах последние функции безопасности отключены или настроены небезопасно.
* Параметры безопасности на серверах приложений, платформах приложений (например, Struts, Spring, ASP.NET), библиотеках, базах данных и т.д. не устанавливаются в безопасные значения.
* Сервер не отправляет заголовки или директивы безопасности, или для них не установлены безопасные значения.
* Программное обеспечение устарело или уязвимо (см. A06:2021 — Уязвимые и устаревшие компоненты).

Как предотвратить:

* Повторяемый процесс усиления безопасности позволяет быстро и легко развернуть другую среду, которая должным образом заблокирована. Среды разработки, контроля качества и производства должны быть настроены одинаково, с использованием разных учетных данных в каждой среде. Этот процесс следует автоматизировать, чтобы свести к минимуму усилия, необходимые для настройки новой безопасной среды.
* Минимальная платформа без лишних функций, компонентов, документации и примеров. Удалите или не устанавливайте неиспользуемые функции и платформы.
* Задача по просмотру и обновлению конфигураций, соответствующих всем примечаниям, обновлениям и исправлениям безопасности, в рамках процесса управления исправлениями (см. A06:2021 — Уязвимые и устаревшие компоненты). Проверьте разрешения облачного хранилища (например, разрешения корзины S3).
* Сегментированная архитектура приложений обеспечивает эффективное и безопасное разделение между компонентами или арендаторами с помощью сегментации, контейнеризации или облачных групп безопасности (ACL).
* Отправка директив безопасности клиентам, например, заголовков безопасности.
* Автоматизированный процесс проверки эффективности конфигураций и настроек во всех средах.

Для данного блока уязвимостей в OWASP определили 20 CWE (подробнее можно посмотреть в источнике), здесь же приведены наиболее простые/популярные:

* Password in Configuration File
* .NET Misconfigurations
* Use a hard-coded, Security-relevant Constants
* Missing Custom Error Page
* Sensitive Cookie Without "HttpOnly" Flag
* CWE-16 Configuration

------------------------------------------------------------

##### A06:2021-Vulnerable and Outdated Components

------------------------------------------------------------

##### A07:2021-Identification and Authentication Failures

------------------------------------------------------------

##### A08:2021-Software and Data Integrity Failures

------------------------------------------------------------

##### A09:2021-Security Logging and Monitoring Failures

------------------------------------------------------------

##### A10:2021-Server-Side Request Forgery

------------------------------------------------------------

### 2. Опишите процессы, происходящие от ввода в URL строку google.com, до получение страницы поисковика (как работает веб-сервис?) Какие атаки на каждам из этапов могут быть реализованы?

### 3. Какие виды SQL-инъекций вы знаете? Расскажите о них.

### 4. Какие виды XSS вы знаете? Расскажите о них.

### 5. Расскажите в чём разница между уязвимостями path treversal и file inclusion. Что опаснее и почему?

### 6. Что отличает DOM XSS от хранимой XSS (помиимо факта работы непосрдественно с DOM)?

### 7. Опешите методику проведения пентеста. (Указать этапы, набор утилит, которые вы будете использовать на каждом из этапов, а также пояснение, как вы будете использовать найденную на каждом из этапов информацию в дальнейшем).

### 8. Модель OSI и описание служб работающих на каждом уровне.

### 9. Известные вам методологии тестирования. Опишити их область применения и ключевые отличия.

### 10. Что такое Active Directory? Для чего она нужна? Зачем ее используют? (Для использования ролевых моделей) Что такое дерево и лес, как они формируются? Какие атаки на AD вам известны? (app-pass-the-hesh? woulden_tiket? kpk-accaunt (kerberos)?)

### 11. Знание Windows и Linux. Вопросы по bash, демоны, логирование, администрирование, встроенные брендмауеры.

### 12. Пример системы для пентеста и описание полного алгоритма (логики проведения пентеста).

- Модель тестирования (box).
- Фишинг OSINT.
- Закрепление в системе.
- Дальнейшее проведение.
- Результаты пентеста (подробный отчет с описаниме проблем, методов защиты и требований к зачистке информации за собой).

### 13. Что должно входить в отчет?


## Приктические задания

1. Вам выдан доступ к удаленной станции по VPN. Ваша задача залогиниться на коммутаторе с IP-адресом _таким-то_ под пользователем _admin_. Брутить пароль бессмысленно, он длинный и сложный. Сканирование портов блокируется на 10 секунд.
2. Вам дан дамп сетевого трафика снятый между клиентом и веб-сервером. Первичная аутентификация строиться на основании HTTP аутентификации. Проверьте безопасно ли реализована аутентификация и получите передаваемые данные.

## Решения приктических заданий
